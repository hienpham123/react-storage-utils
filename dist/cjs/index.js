"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("idb"),r=require("crypto-js"),t=require("react"),n=require("@fluentui/react");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach(function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}}),r.default=e,Object.freeze(r)}var s=o(r),i=o(t),c=a(t),u=function(){return u=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e},u.apply(this,arguments)};function l(e,r,t,n){return new(t||(t=Promise))(function(o,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function i(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var r;e.done?o(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(s,i)}c((n=n.apply(e,r||[])).next())})}function f(e,r){var t,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=i(0),s.throw=i(1),s.return=i(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(c){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(a=0)),a;)try{if(t=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(e,a)}catch(e){i=[6,e],n=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}"function"==typeof SuppressedError&&SuppressedError;var p="FormDraftDB",y="drafts",d=process.env.REACT_APP_SECRET_KEY||"",b=null,v=function(){return b||(b=e.openDB(p,1,{upgrade:function(e){e.createObjectStore(y,{keyPath:"key"})}})),b},m=function(e){return s.default.AES.encrypt(e,d).toString()},g=function(e){return s.default.AES.decrypt(e,d).toString(s.default.enc.Utf8)},h=function(e){return new Promise(function(r,t){var n=new FileReader;n.onload=function(){return r({name:e.name,type:e.type,data:n.result})},n.onerror=t,n.readAsDataURL(e)})},S=function(e){return l(void 0,void 0,void 0,function(){var r,t,n;return f(this,function(o){switch(o.label){case 0:r=0,t=e,o.label=1;case 1:return r<t.length?(n=t[r],[4,k(n)]):[3,4];case 2:if(o.sent())return[2,!0];o.label=3;case 3:return r++,[3,1];case 4:return[2,!1]}})})},k=function(e){return l(void 0,void 0,void 0,function(){var r;return f(this,function(t){switch(t.label){case 0:return[4,v()];case 1:return[4,t.sent().get(y,e)];case 2:return[2,!(!(r=t.sent())||!r.value)]}})})},j={exports:{}},w={},_=Symbol.for("react.transitional.element"),x=Symbol.for("react.fragment");function O(e,r,t){var n=null;if(void 0!==t&&(n=""+t),void 0!==r.key&&(n=""+r.key),"key"in r)for(var o in t={},r)"key"!==o&&(t[o]=r[o]);else t=r;return r=t.ref,{$$typeof:_,type:e,key:n,ref:void 0!==r?r:null,props:t}}w.Fragment=x,w.jsx=O,w.jsxs=O;var P={};
/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */"production"!==process.env.NODE_ENV&&function(){function e(r){if(null==r)return null;if("function"==typeof r)return r.$$typeof===x?null:r.displayName||r.name||null;if("string"==typeof r)return r;switch(r){case d:return"Fragment";case v:return"Profiler";case b:return"StrictMode";case S:return"Suspense";case k:return"SuspenseList";case _:return"Activity"}if("object"==typeof r)switch("number"==typeof r.tag&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),r.$$typeof){case y:return"Portal";case g:return r.displayName||"Context";case m:return(r._context.displayName||"Context")+".Consumer";case h:var t=r.render;return(r=r.displayName)||(r=""!==(r=t.displayName||t.name||"")?"ForwardRef("+r+")":"ForwardRef"),r;case j:return null!==(t=r.displayName||null)?t:e(r.type)||"Memo";case w:t=r._payload,r=r._init;try{return e(r(t))}catch(e){}}return null}function r(e){return""+e}function t(e){try{r(e);var t=!1}catch(e){t=!0}if(t){var n=(t=console).error,o="function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return n.call(t,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",o),r(e)}}function n(r){if(r===d)return"<>";if("object"==typeof r&&null!==r&&r.$$typeof===w)return"<...>";try{var t=e(r);return t?"<"+t+">":"<...>"}catch(e){return"<...>"}}function o(){return Error("react-stack-top-frame")}function a(){var r=e(this.type);return A[r]||(A[r]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),void 0!==(r=this.props.ref)?r:null}function s(r,n,o,s,i,u){var f,y=n.children;if(void 0!==y)if(s)if(N(y)){for(s=0;s<y.length;s++)c(y[s]);Object.freeze&&Object.freeze(y)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else c(y);if(E.call(n,"key")){y=e(r);var d=Object.keys(n).filter(function(e){return"key"!==e});s=0<d.length?"{key: someKey, "+d.join(": ..., ")+": ...}":"{key: someKey}",C[y+s]||(d=0<d.length?"{"+d.join(": ..., ")+": ...}":"{}",console.error('A props object containing a "key" prop is being spread into JSX:\n  let props = %s;\n  <%s {...props} />\nReact keys must be passed directly to JSX without using spread:\n  let props = %s;\n  <%s key={someKey} {...props} />',s,y,d,y),C[y+s]=!0)}if(y=null,void 0!==o&&(t(o),y=""+o),function(e){if(E.call(e,"key")){var r=Object.getOwnPropertyDescriptor(e,"key").get;if(r&&r.isReactWarning)return!1}return void 0!==e.key}(n)&&(t(n.key),y=""+n.key),"key"in n)for(var b in o={},n)"key"!==b&&(o[b]=n[b]);else o=n;return y&&function(e,r){function t(){l||(l=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",r))}t.isReactWarning=!0,Object.defineProperty(e,"key",{get:t,configurable:!0})}(o,"function"==typeof r?r.displayName||r.name||"Unknown":r),function(e,r,t,n,o,s){var i=t.ref;return e={$$typeof:p,type:e,key:r,props:t,_owner:n},null!==(void 0!==i?i:null)?Object.defineProperty(e,"ref",{enumerable:!1,get:a}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:o}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:s}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}(r,y,o,null===(f=O.A)?null:f.getOwner(),i,u)}function c(e){u(e)?e._store&&(e._store.validated=1):"object"==typeof e&&null!==e&&e.$$typeof===w&&("fulfilled"===e._payload.status?u(e._payload.value)&&e._payload.value._store&&(e._payload.value._store.validated=1):e._store&&(e._store.validated=1))}function u(e){return"object"==typeof e&&null!==e&&e.$$typeof===p}var l,f=i.default,p=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),d=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),m=Symbol.for("react.consumer"),g=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),x=Symbol.for("react.client.reference"),O=f.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,E=Object.prototype.hasOwnProperty,N=Array.isArray,D=console.createTask?console.createTask:function(){return null},A={},T=(f={react_stack_bottom_frame:function(e){return e()}}).react_stack_bottom_frame.bind(f,o)(),R=D(n(o)),C={};P.Fragment=d,P.jsx=function(e,r,t){var o=1e4>O.recentlyCreatedOwnerStacks++;return s(e,r,t,!1,o?Error("react-stack-top-frame"):T,o?D(n(e)):R)},P.jsxs=function(e,r,t){var o=1e4>O.recentlyCreatedOwnerStacks++;return s(e,r,t,!0,o?Error("react-stack-top-frame"):T,o?D(n(e)):R)}}(),"production"===process.env.NODE_ENV?j.exports=w:j.exports=P;exports.checkHasDraftInStorage=S,exports.checkStorageAndNotify=function(e,r,t){return l(void 0,void 0,void 0,function(){var n,o,a,s,i,c,u;return f(this,function(l){switch(l.label){case 0:return[4,v()];case 1:n=l.sent(),o=n.transaction(y,"readonly").objectStore(y),a=!1,s=0,i=e,l.label=2;case 2:return s<i.length?(c=i[s],[4,o.get(c)]):[3,5];case 3:if((u=l.sent())&&u.value)return a=!0,[3,5];l.label=4;case 4:return s++,[3,2];case 5:return a?setTimeout(function(){r(e,t)},1e3):t(!1),[2]}})})},exports.decryptPassword=g,exports.encryptPassword=m,exports.fileToJson=h,exports.getDraftFromStorage=function(e){return l(void 0,void 0,void 0,function(){var r,t,n;return f(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,v()];case 1:return[4,o.sent().get(y,e)];case 2:return(r=o.sent())?(t=g(r.value),[2,JSON.parse(t)]):[2,null];case 3:return n=o.sent(),console.error("getDraftFromStorage failed:",n),[2,null];case 4:return[2]}})})},exports.jsonToFile=function(e){return l(void 0,void 0,void 0,function(){var r,t;return f(this,function(n){switch(n.label){case 0:return[4,fetch(e.data)];case 1:return[4,n.sent().blob()];case 2:return r=n.sent(),t=e.name||e.FileName||"untitled",[2,new File([r],t,{type:e.type})]}})})},exports.removeDraftFromStorage=function(e){var r=e.keysArr;return l(void 0,void 0,void 0,function(){var e,t,n,o,a,s;return f(this,function(i){switch(i.label){case 0:return[4,v()];case 1:e=i.sent(),t=e.transaction(y,"readwrite"),n=t.objectStore(y),o=0,a=r,i.label=2;case 2:return o<a.length?(s=a[o],[4,n.delete(s)]):[3,5];case 3:i.sent(),i.label=4;case 4:return o++,[3,2];case 5:return[4,t.done];case 6:return i.sent(),[2]}})})},exports.saveDraftToStorage=function(r){var t=r.entries;return l(void 0,void 0,void 0,function(){var r,n,o,a,s,i,c,u,l,d,b,v,g,S,k;return f(this,function(f){switch(f.label){case 0:return[4,e.openDB(p,1)];case 1:r=f.sent(),n=[],o=0,a=t,f.label=2;case 2:return o<a.length?(s=a[o],i=s[0],c=s[1],u=c,Array.isArray(c)&&c.length&&c[0]instanceof File?[4,Promise.all(c.map(h))]:[3,4]):[3,9];case 3:return l=f.sent(),u=m(JSON.stringify(l)),[3,7];case 4:return c instanceof File?[4,h(c)]:[3,6];case 5:return d=f.sent(),u=m(JSON.stringify(d)),[3,7];case 6:(Array.isArray(c)&&c.length||!Array.isArray(c)&&c)&&(u=m(JSON.stringify(c))),f.label=7;case 7:n.push({key:i,value:u}),f.label=8;case 8:return o++,[3,2];case 9:b=r.transaction(y,"readwrite"),v=b.objectStore(y),g=0,S=n,f.label=10;case 10:return g<S.length?(k=S[g],[4,v.put(k)]):[3,13];case 11:f.sent(),f.label=12;case 12:return g++,[3,10];case 13:return[4,b.done];case 14:return f.sent(),[2]}})})},exports.useDraftCheck=function(e){var r=e.keys,t=e.onConfirm,o=c.useState(!1),a=o[0],s=o[1];c.useEffect(function(){l(void 0,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,S(r)];case 1:return n.sent()?s(!0):t(!1),[3,3];case 2:return e=n.sent(),console.error("checkHasDraftInStorage failed:",e),t(!1),[3,3];case 3:return[2]}})})},[]);var i=c.useCallback(function(){s(!1),t(!0)},[t]),p=c.useCallback(function(){s(!1),t(!1)},[t]);return{dialog:j.exports.jsx(n.Dialog,u({hidden:!a,onDismiss:p,dialogContentProps:{type:n.DialogType.normal,title:"Restore data?",closeButtonAriaLabel:"Close",subText:"Do you want to restore the previously entered data before submitting/saving again?"},modalProps:{isBlocking:!0,styles:{main:{maxWidth:450}}}},{children:j.exports.jsxs(n.DialogFooter,{children:[j.exports.jsx(n.PrimaryButton,{onClick:i,text:"Yes, restore"}),j.exports.jsx(n.DefaultButton,{onClick:p,text:"No"})]})}))}};
//# sourceMappingURL=index.js.map
