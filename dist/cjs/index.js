"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("idb");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(require("crypto-js"));function n(e,t,r,n){return new(r||(r=Promise))(function(a,o){function u(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(u,s)}c((n=n.apply(e,t||[])).next())})}function a(e,t){var r,n,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=s(0),u.throw=s(1),u.return=s(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,s[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}"function"==typeof SuppressedError&&SuppressedError;var o="FormDraftDB",u="drafts",s="react-storage-secret-key",c=null,i=function(){return c||(c=e.openDB(o,1,{upgrade:function(e){e.createObjectStore(u,{keyPath:"key"})}})),c},l=function(e){return r.default.AES.encrypt(e,s).toString()},f=function(e){return r.default.AES.decrypt(e,s).toString(r.default.enc.Utf8)},d=function(e){return new Promise(function(t,r){var n=new FileReader;n.onload=function(){return t({name:e.name,type:e.type,data:n.result})},n.onerror=r,n.readAsDataURL(e)})},p=function(e){return n(void 0,void 0,void 0,function(){var t;return a(this,function(r){switch(r.label){case 0:return[4,i()];case 1:return[4,r.sent().get(u,e)];case 2:return[2,!(!(t=r.sent())||!t.value)]}})})};exports.checkHasDraftInStorage=function(e){return n(void 0,void 0,void 0,function(){var t,r,n;return a(this,function(a){switch(a.label){case 0:t=0,r=e,a.label=1;case 1:return t<r.length?(n=r[t],[4,p(n)]):[3,4];case 2:if(a.sent())return[2,!0];a.label=3;case 3:return t++,[3,1];case 4:return[2,!1]}})})},exports.checkStorageAndNotify=function(e,t,r){return n(void 0,void 0,void 0,function(){var n,o,s,c,l,f,d;return a(this,function(a){switch(a.label){case 0:return[4,i()];case 1:n=a.sent(),o=n.transaction(u,"readonly").objectStore(u),s=!1,c=0,l=e,a.label=2;case 2:return c<l.length?(f=l[c],[4,o.get(f)]):[3,5];case 3:if((d=a.sent())&&d.value)return s=!0,[3,5];a.label=4;case 4:return c++,[3,2];case 5:return s?setTimeout(function(){t(e,r)},1e3):r(!1),[2]}})})},exports.decryptPassword=f,exports.encryptPassword=l,exports.fileToJson=d,exports.getDraftFromStorage=function(e){return n(void 0,void 0,void 0,function(){var t,r,n;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,i()];case 1:return[4,a.sent().get(u,e)];case 2:return(t=a.sent())?(r=f(t.value),[2,JSON.parse(r)]):[2,null];case 3:return n=a.sent(),console.error("getDraftFromStorage failed:",n),[2,null];case 4:return[2]}})})},exports.jsonToFile=function(e){return n(void 0,void 0,void 0,function(){var t,r;return a(this,function(n){switch(n.label){case 0:return[4,fetch(e.data)];case 1:return[4,n.sent().blob()];case 2:return t=n.sent(),r=e.name||e.FileName||"untitled",[2,new File([t],r,{type:e.type})]}})})},exports.removeDraftFromStorage=function(e){var t=e.keysArr;return n(void 0,void 0,void 0,function(){var e,r,n,o,s,c;return a(this,function(a){switch(a.label){case 0:return[4,i()];case 1:e=a.sent(),r=e.transaction(u,"readwrite"),n=r.objectStore(u),o=0,s=t,a.label=2;case 2:return o<s.length?(c=s[o],[4,n.delete(c)]):[3,5];case 3:a.sent(),a.label=4;case 4:return o++,[3,2];case 5:return[4,r.done];case 6:return a.sent(),[2]}})})},exports.saveDraftToStorage=function(t){var r=t.entries;return n(void 0,void 0,void 0,function(){var t,n,s,c,i,f,p,v,y,b,h,g,w,S,m;return a(this,function(a){switch(a.label){case 0:return[4,e.openDB(o,1)];case 1:t=a.sent(),n=[],s=0,c=r,a.label=2;case 2:return s<c.length?(i=c[s],f=i[0],p=i[1],v=p,Array.isArray(p)&&p.length&&p[0]instanceof File?[4,Promise.all(p.map(d))]:[3,4]):[3,9];case 3:return y=a.sent(),v=l(JSON.stringify(y)),[3,7];case 4:return p instanceof File?[4,d(p)]:[3,6];case 5:return b=a.sent(),v=l(JSON.stringify(b)),[3,7];case 6:(Array.isArray(p)&&p.length||!Array.isArray(p)&&p)&&(v=l(JSON.stringify(p))),a.label=7;case 7:n.push({key:f,value:v}),a.label=8;case 8:return s++,[3,2];case 9:h=t.transaction(u,"readwrite"),g=h.objectStore(u),w=0,S=n,a.label=10;case 10:return w<S.length?(m=S[w],[4,g.put(m)]):[3,13];case 11:a.sent(),a.label=12;case 12:return w++,[3,10];case 13:return[4,h.done];case 14:return a.sent(),[2]}})})};
//# sourceMappingURL=index.js.map
