"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("idb"),t=require("crypto-js"),r=require("react"),n=require("@fluentui/react");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}var s=o(t),i=o(r),c=a(r),l=function(e,t){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},l(e,t)};var u=function(){return u=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},u.apply(this,arguments)};function f(e,t,r,n){return new(r||(r=Promise))(function(o,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function i(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,i)}c((n=n.apply(e,t||[])).next())})}function p(e,t){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=i(0),s.throw=i(1),s.return=i(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}"function"==typeof SuppressedError&&SuppressedError;var y="FormDraftDB",d="drafts",b=process.env.REACT_APP_SECRET_KEY||"",h=null,v=function(){return h||(h=e.openDB(y,1,{upgrade:function(e){e.createObjectStore(d,{keyPath:"key"})}})),h},m=function(e){return s.default.AES.encrypt(e,b).toString()},g=function(e){return s.default.AES.decrypt(e,b).toString(s.default.enc.Utf8)},k=function(e){return new Promise(function(t,r){var n=new FileReader;n.onload=function(){return t({name:e.name,type:e.type,data:n.result})},n.onerror=r,n.readAsDataURL(e)})},S=function(e){return f(void 0,void 0,void 0,function(){var t,r;return p(this,function(n){switch(n.label){case 0:return[4,fetch(e.data)];case 1:return[4,n.sent().blob()];case 2:return t=n.sent(),r=e.name||e.FileName||"untitled",[2,new File([t],r,{type:e.type})]}})})},j=function(e){var t=e.keysArr;return f(void 0,void 0,void 0,function(){var e,r,n,o,a,s;return p(this,function(i){switch(i.label){case 0:return[4,v()];case 1:e=i.sent(),r=e.transaction(d,"readwrite"),n=r.objectStore(d),o=0,a=t,i.label=2;case 2:return o<a.length?(s=a[o],[4,n.delete(s)]):[3,5];case 3:i.sent(),i.label=4;case 4:return o++,[3,2];case 5:return[4,r.done];case 6:return i.sent(),[2]}})})},w=function(e){return f(void 0,void 0,void 0,function(){var t,r,n;return p(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,v()];case 1:return[4,o.sent().get(d,e)];case 2:return(t=o.sent())?(r=g(t.value),[2,JSON.parse(r)]):[2,null];case 3:return n=o.sent(),console.error("getDraftFromStorage failed:",n),[2,null];case 4:return[2]}})})},O=function(e){return f(void 0,void 0,void 0,function(){var t,r,n;return p(this,function(o){switch(o.label){case 0:t=0,r=e,o.label=1;case 1:return t<r.length?(n=r[t],[4,_(n)]):[3,4];case 2:if(o.sent())return[2,!0];o.label=3;case 3:return t++,[3,1];case 4:return[2,!1]}})})},_=function(e){return f(void 0,void 0,void 0,function(){var t;return p(this,function(r){switch(r.label){case 0:return[4,v()];case 1:return[4,r.sent().get(d,e)];case 2:return[2,!(!(t=r.sent())||!t.value)]}})})},x={exports:{}},D={},C=Symbol.for("react.transitional.element"),P=Symbol.for("react.fragment");function A(e,t,r){var n=null;if(void 0!==r&&(n=""+r),void 0!==t.key&&(n=""+t.key),"key"in t)for(var o in r={},t)"key"!==o&&(r[o]=t[o]);else r=t;return t=r.ref,{$$typeof:C,type:e,key:n,ref:void 0!==t?t:null,props:r}}D.Fragment=P,D.jsx=A,D.jsxs=A;var T={};
/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */"production"!==process.env.NODE_ENV&&function(){function e(t){if(null==t)return null;if("function"==typeof t)return t.$$typeof===_?null:t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case d:return"Fragment";case h:return"Profiler";case b:return"StrictMode";case k:return"Suspense";case S:return"SuspenseList";case O:return"Activity"}if("object"==typeof t)switch("number"==typeof t.tag&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),t.$$typeof){case y:return"Portal";case m:return t.displayName||"Context";case v:return(t._context.displayName||"Context")+".Consumer";case g:var r=t.render;return(t=t.displayName)||(t=""!==(t=r.displayName||r.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case j:return null!==(r=t.displayName||null)?r:e(t.type)||"Memo";case w:r=t._payload,t=t._init;try{return e(t(r))}catch(e){}}return null}function t(e){return""+e}function r(e){try{t(e);var r=!1}catch(e){r=!0}if(r){var n=(r=console).error,o="function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return n.call(r,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",o),t(e)}}function n(t){if(t===d)return"<>";if("object"==typeof t&&null!==t&&t.$$typeof===w)return"<...>";try{var r=e(t);return r?"<"+r+">":"<...>"}catch(e){return"<...>"}}function o(){return Error("react-stack-top-frame")}function a(){var t=e(this.type);return A[t]||(A[t]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),void 0!==(t=this.props.ref)?t:null}function s(t,n,o,s,i,l){var f,y=n.children;if(void 0!==y)if(s)if(C(y)){for(s=0;s<y.length;s++)c(y[s]);Object.freeze&&Object.freeze(y)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else c(y);if(D.call(n,"key")){y=e(t);var d=Object.keys(n).filter(function(e){return"key"!==e});s=0<d.length?"{key: someKey, "+d.join(": ..., ")+": ...}":"{key: someKey}",R[y+s]||(d=0<d.length?"{"+d.join(": ..., ")+": ...}":"{}",console.error('A props object containing a "key" prop is being spread into JSX:\n  let props = %s;\n  <%s {...props} />\nReact keys must be passed directly to JSX without using spread:\n  let props = %s;\n  <%s key={someKey} {...props} />',s,y,d,y),R[y+s]=!0)}if(y=null,void 0!==o&&(r(o),y=""+o),function(e){if(D.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}(n)&&(r(n.key),y=""+n.key),"key"in n)for(var b in o={},n)"key"!==b&&(o[b]=n[b]);else o=n;return y&&function(e,t){function r(){u||(u=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",t))}r.isReactWarning=!0,Object.defineProperty(e,"key",{get:r,configurable:!0})}(o,"function"==typeof t?t.displayName||t.name||"Unknown":t),function(e,t,r,n,o,s){var i=r.ref;return e={$$typeof:p,type:e,key:t,props:r,_owner:n},null!==(void 0!==i?i:null)?Object.defineProperty(e,"ref",{enumerable:!1,get:a}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:o}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:s}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}(t,y,o,null===(f=x.A)?null:f.getOwner(),i,l)}function c(e){l(e)?e._store&&(e._store.validated=1):"object"==typeof e&&null!==e&&e.$$typeof===w&&("fulfilled"===e._payload.status?l(e._payload.value)&&e._payload.value._store&&(e._payload.value._store.validated=1):e._store&&(e._store.validated=1))}function l(e){return"object"==typeof e&&null!==e&&e.$$typeof===p}var u,f=i.default,p=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),d=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),v=Symbol.for("react.consumer"),m=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),O=Symbol.for("react.activity"),_=Symbol.for("react.client.reference"),x=f.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D=Object.prototype.hasOwnProperty,C=Array.isArray,P=console.createTask?console.createTask:function(){return null},A={},E=(f={react_stack_bottom_frame:function(e){return e()}}).react_stack_bottom_frame.bind(f,o)(),N=P(n(o)),R={};T.Fragment=d,T.jsx=function(e,t,r){var o=1e4>x.recentlyCreatedOwnerStacks++;return s(e,t,r,!1,o?Error("react-stack-top-frame"):E,o?P(n(e)):N)},T.jsxs=function(e,t,r){var o=1e4>x.recentlyCreatedOwnerStacks++;return s(e,t,r,!0,o?Error("react-stack-top-frame"):E,o?P(n(e)):N)}}(),"production"===process.env.NODE_ENV?x.exports=D:x.exports=T;var E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isDialogVisible:!1,draftData:{}},t.checkDraft=function(){return f(t,void 0,void 0,function(){var e,t,r,n,o,a,s,i,c,l,u=this;return p(this,function(f){switch(f.label){case 0:return f.trys.push([0,8,,9]),e=this.props,t=e.keys,r=e.onConfirm,[4,O(t)];case 1:n=f.sent(),o={},a=0,s=t,f.label=2;case 2:return a<s.length?(i=s[a],[4,w(i)]):[3,7];case 3:return(c=f.sent())&&Object.hasOwn(c,"data")&&Object.hasOwn(c,"type")&&Object.hasOwn(c,"name")?[4,S(c)]:[3,5];case 4:c=f.sent(),f.label=5;case 5:null!=c&&(o[i]=c),f.label=6;case 6:return a++,[3,2];case 7:return this.setState({draftData:o}),n?setTimeout(function(){u.setState({isDialogVisible:!0})},1e3):r(null),[3,9];case 8:return l=f.sent(),console.error("Draft check failed:",l),this.props.onConfirm(null),[3,9];case 9:return[2]}})})},t.handleConfirm=function(){t.setState({isDialogVisible:!1}),t.props.onConfirm(t.state.draftData)},t.handleCancel=function(){return f(t,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return this.setState({isDialogVisible:!1}),this.props.onConfirm(null),[4,j({keysArr:this.props.keys})];case 1:return e.sent(),[2]}})})},t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t.prototype.componentDidMount=function(){!1!==this.props.condition&&this.checkDraft()},t.prototype.render=function(){var e=this.state.isDialogVisible;return x.exports.jsx(n.Dialog,u({hidden:!e,onDismiss:this.handleCancel,dialogContentProps:{type:n.DialogType.normal,title:"Restore data?",closeButtonAriaLabel:"Close",subText:"Do you want to restore the previously entered data before submitting/saving again?"},minWidth:450,modalProps:{isBlocking:!0}},{children:x.exports.jsxs(n.DialogFooter,{children:[x.exports.jsx(n.PrimaryButton,{onClick:this.handleConfirm,text:"Yes, restore"}),x.exports.jsx(n.DefaultButton,{onClick:this.handleCancel,text:"No"})]})}))},t}(c.Component);exports.DraftCheckManager=E,exports.checkHasDraftInStorage=O,exports.checkStorageAndNotify=function(e,t,r){return f(void 0,void 0,void 0,function(){var n,o,a,s,i,c,l;return p(this,function(u){switch(u.label){case 0:return[4,v()];case 1:n=u.sent(),o=n.transaction(d,"readonly").objectStore(d),a=!1,s=0,i=e,u.label=2;case 2:return s<i.length?(c=i[s],[4,o.get(c)]):[3,5];case 3:if((l=u.sent())&&l.value)return a=!0,[3,5];u.label=4;case 4:return s++,[3,2];case 5:return a?setTimeout(function(){t(e,r)},1e3):r(!1),[2]}})})},exports.decryptPassword=g,exports.encryptPassword=m,exports.fileToJson=k,exports.getDraftFromStorage=w,exports.jsonToFile=S,exports.removeDraftFromStorage=j,exports.saveDraftToStorage=function(t){var r=t.entries;return f(void 0,void 0,void 0,function(){var t,n,o,a,s,i,c,l,u,f,b,h,v,g,S;return p(this,function(p){switch(p.label){case 0:return[4,e.openDB(y,1)];case 1:t=p.sent(),n=[],o=0,a=r,p.label=2;case 2:return o<a.length?(s=a[o],i=s[0],c=s[1],l=c,Array.isArray(c)&&c.length&&c[0]instanceof File?[4,Promise.all(c.map(k))]:[3,4]):[3,9];case 3:return u=p.sent(),l=m(JSON.stringify(u)),[3,7];case 4:return c instanceof File?[4,k(c)]:[3,6];case 5:return f=p.sent(),l=m(JSON.stringify(f)),[3,7];case 6:(Array.isArray(c)&&c.length||!Array.isArray(c)&&c)&&(l=m(JSON.stringify(c))),p.label=7;case 7:n.push({key:i,value:l}),p.label=8;case 8:return o++,[3,2];case 9:b=t.transaction(d,"readwrite"),h=b.objectStore(d),v=0,g=n,p.label=10;case 10:return v<g.length?(S=g[v],[4,h.put(S)]):[3,13];case 11:p.sent(),p.label=12;case 12:return v++,[3,10];case 13:return[4,b.done];case 14:return p.sent(),[2]}})})},exports.useDraftCheck=function(e){var t=e.keys,r=e.onConfirm,o=e.condition,a=void 0===o||o,s=e.dependencies,i=void 0===s?[]:s,l=c.useState(!1),y=l[0],d=l[1],b=c.useState({}),h=b[0],v=b[1];c.useEffect(function(){a&&f(void 0,void 0,void 0,function(){var e,n,o,a,s,i,c;return p(this,function(l){switch(l.label){case 0:return l.trys.push([0,8,,9]),[4,O(t)];case 1:e=l.sent(),n={},o=0,a=t,l.label=2;case 2:return o<a.length?(s=a[o],[4,w(s)]):[3,7];case 3:return(i=l.sent())&&Object.hasOwn(i,"data")&&Object.hasOwn(i,"type")&&Object.hasOwn(i,"name")?[4,S(i)]:[3,5];case 4:i=l.sent(),l.label=5;case 5:null!=i&&(n[s]=i),l.label=6;case 6:return o++,[3,2];case 7:return v(n),e?setTimeout(function(){d(!0)},1e3):r(null),[3,9];case 8:return c=l.sent(),console.error("checkHasDraftInStorage failed:",c),r(null),[3,9];case 9:return[2]}})})},function(e,t,r){if(r||2===arguments.length)for(var n,o=0,a=t.length;o<a;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}([],i,!0));var m=c.useCallback(function(){d(!1),r(h)},[r,h]),g=c.useCallback(function(){d(!1),r(null),j({keysArr:t})},[r,t]);return{dialog:x.exports.jsx(n.Dialog,u({hidden:!y,onDismiss:g,dialogContentProps:{type:n.DialogType.normal,title:"Restore data?",closeButtonAriaLabel:"Close",subText:"Do you want to restore the previously entered data before submitting/saving again?"},minWidth:450,modalProps:{isBlocking:!0}},{children:x.exports.jsxs(n.DialogFooter,{children:[x.exports.jsx(n.PrimaryButton,{onClick:m,text:"Yes, restore"}),x.exports.jsx(n.DefaultButton,{onClick:g,text:"No"})]})}))}};
//# sourceMappingURL=index.js.map
