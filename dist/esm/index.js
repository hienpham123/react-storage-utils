import{openDB as e}from"idb";import r from"crypto-js";import*as t from"react";import n from"react";import{Dialog as o,DialogFooter as a,PrimaryButton as i,DefaultButton as s,DialogType as c}from"@fluentui/react";var l=function(){return l=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e},l.apply(this,arguments)};function u(e,r,t,n){return new(t||(t=Promise))(function(o,a){function i(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var r;e.done?o(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(i,s)}c((n=n.apply(e,r||[])).next())})}function f(e,r){var t,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(t=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=r.call(e,a)}catch(e){s=[6,e],n=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}"function"==typeof SuppressedError&&SuppressedError;var p="FormDraftDB",y="drafts",d=process.env.REACT_APP_SECRET_KEY||"",b=null,v=function(){return b||(b=e(p,1,{upgrade:function(e){e.createObjectStore(y,{keyPath:"key"})}})),b},m=function(e){return r.AES.encrypt(e,d).toString()},h=function(e){return r.AES.decrypt(e,d).toString(r.enc.Utf8)},g=function(e){return new Promise(function(r,t){var n=new FileReader;n.onload=function(){return r({name:e.name,type:e.type,data:n.result})},n.onerror=t,n.readAsDataURL(e)})},S=function(e){return u(void 0,void 0,void 0,function(){var r,t;return f(this,function(n){switch(n.label){case 0:return[4,fetch(e.data)];case 1:return[4,n.sent().blob()];case 2:return r=n.sent(),t=e.name||e.FileName||"untitled",[2,new File([r],t,{type:e.type})]}})})},k=function(e){var r=e.keysArr;return u(void 0,void 0,void 0,function(){var e,t,n,o,a,i;return f(this,function(s){switch(s.label){case 0:return[4,v()];case 1:e=s.sent(),t=e.transaction(y,"readwrite"),n=t.objectStore(y),o=0,a=r,s.label=2;case 2:return o<a.length?(i=a[o],[4,n.delete(i)]):[3,5];case 3:s.sent(),s.label=4;case 4:return o++,[3,2];case 5:return[4,t.done];case 6:return s.sent(),[2]}})})},w=function(r){var t=r.entries;return u(void 0,void 0,void 0,function(){var r,n,o,a,i,s,c,l,u,d,b,v,h,S,k;return f(this,function(f){switch(f.label){case 0:return[4,e(p,1)];case 1:r=f.sent(),n=[],o=0,a=t,f.label=2;case 2:return o<a.length?(i=a[o],s=i[0],c=i[1],l=c,Array.isArray(c)&&c.length&&c[0]instanceof File?[4,Promise.all(c.map(g))]:[3,4]):[3,9];case 3:return u=f.sent(),l=m(JSON.stringify(u)),[3,7];case 4:return c instanceof File?[4,g(c)]:[3,6];case 5:return d=f.sent(),l=m(JSON.stringify(d)),[3,7];case 6:(Array.isArray(c)&&c.length||!Array.isArray(c)&&c)&&(l=m(JSON.stringify(c))),f.label=7;case 7:n.push({key:s,value:l}),f.label=8;case 8:return o++,[3,2];case 9:b=r.transaction(y,"readwrite"),v=b.objectStore(y),h=0,S=n,f.label=10;case 10:return h<S.length?(k=S[h],[4,v.put(k)]):[3,13];case 11:f.sent(),f.label=12;case 12:return h++,[3,10];case 13:return[4,b.done];case 14:return f.sent(),[2]}})})},j=function(e){return u(void 0,void 0,void 0,function(){var r,t,n;return f(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,v()];case 1:return[4,o.sent().get(y,e)];case 2:return(r=o.sent())?(t=h(r.value),[2,JSON.parse(t)]):[2,null];case 3:return n=o.sent(),console.error("getDraftFromStorage failed:",n),[2,null];case 4:return[2]}})})},_=function(e){return u(void 0,void 0,void 0,function(){var r,t,n;return f(this,function(o){switch(o.label){case 0:r=0,t=e,o.label=1;case 1:return r<t.length?(n=t[r],[4,O(n)]):[3,4];case 2:if(o.sent())return[2,!0];o.label=3;case 3:return r++,[3,1];case 4:return[2,!1]}})})},O=function(e){return u(void 0,void 0,void 0,function(){var r;return f(this,function(t){switch(t.label){case 0:return[4,v()];case 1:return[4,t.sent().get(y,e)];case 2:return[2,!(!(r=t.sent())||!r.value)]}})})},x=function(e,r,t){return u(void 0,void 0,void 0,function(){var n,o,a,i,s,c,l;return f(this,function(u){switch(u.label){case 0:return[4,v()];case 1:n=u.sent(),o=n.transaction(y,"readonly").objectStore(y),a=!1,i=0,s=e,u.label=2;case 2:return i<s.length?(c=s[i],[4,o.get(c)]):[3,5];case 3:if((l=u.sent())&&l.value)return a=!0,[3,5];u.label=4;case 4:return i++,[3,2];case 5:return a?setTimeout(function(){r(e,t)},1e3):t(!1),[2]}})})},A={exports:{}},E={},N=Symbol.for("react.transitional.element"),P=Symbol.for("react.fragment");function R(e,r,t){var n=null;if(void 0!==t&&(n=""+t),void 0!==r.key&&(n=""+r.key),"key"in r)for(var o in t={},r)"key"!==o&&(t[o]=r[o]);else t=r;return r=t.ref,{$$typeof:N,type:e,key:n,ref:void 0!==r?r:null,props:t}}E.Fragment=P,E.jsx=R,E.jsxs=R;var T={};
/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */"production"!==process.env.NODE_ENV&&function(){function e(r){if(null==r)return null;if("function"==typeof r)return r.$$typeof===O?null:r.displayName||r.name||null;if("string"==typeof r)return r;switch(r){case d:return"Fragment";case v:return"Profiler";case b:return"StrictMode";case S:return"Suspense";case k:return"SuspenseList";case _:return"Activity"}if("object"==typeof r)switch("number"==typeof r.tag&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),r.$$typeof){case y:return"Portal";case h:return r.displayName||"Context";case m:return(r._context.displayName||"Context")+".Consumer";case g:var t=r.render;return(r=r.displayName)||(r=""!==(r=t.displayName||t.name||"")?"ForwardRef("+r+")":"ForwardRef"),r;case w:return null!==(t=r.displayName||null)?t:e(r.type)||"Memo";case j:t=r._payload,r=r._init;try{return e(r(t))}catch(e){}}return null}function r(e){return""+e}function t(e){try{r(e);var t=!1}catch(e){t=!0}if(t){var n=(t=console).error,o="function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return n.call(t,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",o),r(e)}}function o(r){if(r===d)return"<>";if("object"==typeof r&&null!==r&&r.$$typeof===j)return"<...>";try{var t=e(r);return t?"<"+t+">":"<...>"}catch(e){return"<...>"}}function a(){return Error("react-stack-top-frame")}function i(){var r=e(this.type);return P[r]||(P[r]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),void 0!==(r=this.props.ref)?r:null}function s(r,n,o,a,s,l){var f,y=n.children;if(void 0!==y)if(a)if(E(y)){for(a=0;a<y.length;a++)c(y[a]);Object.freeze&&Object.freeze(y)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else c(y);if(A.call(n,"key")){y=e(r);var d=Object.keys(n).filter(function(e){return"key"!==e});a=0<d.length?"{key: someKey, "+d.join(": ..., ")+": ...}":"{key: someKey}",$[y+a]||(d=0<d.length?"{"+d.join(": ..., ")+": ...}":"{}",console.error('A props object containing a "key" prop is being spread into JSX:\n  let props = %s;\n  <%s {...props} />\nReact keys must be passed directly to JSX without using spread:\n  let props = %s;\n  <%s key={someKey} {...props} />',a,y,d,y),$[y+a]=!0)}if(y=null,void 0!==o&&(t(o),y=""+o),function(e){if(A.call(e,"key")){var r=Object.getOwnPropertyDescriptor(e,"key").get;if(r&&r.isReactWarning)return!1}return void 0!==e.key}(n)&&(t(n.key),y=""+n.key),"key"in n)for(var b in o={},n)"key"!==b&&(o[b]=n[b]);else o=n;return y&&function(e,r){function t(){u||(u=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",r))}t.isReactWarning=!0,Object.defineProperty(e,"key",{get:t,configurable:!0})}(o,"function"==typeof r?r.displayName||r.name||"Unknown":r),function(e,r,t,n,o,a){var s=t.ref;return e={$$typeof:p,type:e,key:r,props:t,_owner:n},null!==(void 0!==s?s:null)?Object.defineProperty(e,"ref",{enumerable:!1,get:i}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:o}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:a}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}(r,y,o,null===(f=x.A)?null:f.getOwner(),s,l)}function c(e){l(e)?e._store&&(e._store.validated=1):"object"==typeof e&&null!==e&&e.$$typeof===j&&("fulfilled"===e._payload.status?l(e._payload.value)&&e._payload.value._store&&(e._payload.value._store.validated=1):e._store&&(e._store.validated=1))}function l(e){return"object"==typeof e&&null!==e&&e.$$typeof===p}var u,f=n,p=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),d=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),m=Symbol.for("react.consumer"),h=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),O=Symbol.for("react.client.reference"),x=f.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,A=Object.prototype.hasOwnProperty,E=Array.isArray,N=console.createTask?console.createTask:function(){return null},P={},R=(f={react_stack_bottom_frame:function(e){return e()}}).react_stack_bottom_frame.bind(f,a)(),C=N(o(a)),$={};T.Fragment=d,T.jsx=function(e,r,t){var n=1e4>x.recentlyCreatedOwnerStacks++;return s(e,r,t,!1,n?Error("react-stack-top-frame"):R,n?N(o(e)):C)},T.jsxs=function(e,r,t){var n=1e4>x.recentlyCreatedOwnerStacks++;return s(e,r,t,!0,n?Error("react-stack-top-frame"):R,n?N(o(e)):C)}}(),"production"===process.env.NODE_ENV?A.exports=E:A.exports=T;var C=function(e){var r=e.keys,n=e.onConfirm,p=e.condition,y=void 0===p||p,d=e.dependencies,b=void 0===d?[]:d,v=t.useState(!1),m=v[0],h=v[1],g=t.useState({}),w=g[0],O=g[1];t.useEffect(function(){y&&u(void 0,void 0,void 0,function(){var e,t,o,a,i,s,c;return f(this,function(l){switch(l.label){case 0:return l.trys.push([0,8,,9]),[4,_(r)];case 1:e=l.sent(),t={},o=0,a=r,l.label=2;case 2:return o<a.length?(i=a[o],[4,j(i)]):[3,7];case 3:return(s=l.sent())&&Object.hasOwn(s,"data")&&Object.hasOwn(s,"type")&&Object.hasOwn(s,"name")?[4,S(s)]:[3,5];case 4:s=l.sent(),l.label=5;case 5:null!=s&&(t[i]=s),l.label=6;case 6:return o++,[3,2];case 7:return O(t),e?setTimeout(function(){h(!0)},1e3):n(null),[3,9];case 8:return c=l.sent(),console.error("checkHasDraftInStorage failed:",c),n(null),[3,9];case 9:return[2]}})})},function(e,r,t){if(t||2===arguments.length)for(var n,o=0,a=r.length;o<a;o++)!n&&o in r||(n||(n=Array.prototype.slice.call(r,0,o)),n[o]=r[o]);return e.concat(n||Array.prototype.slice.call(r))}([],b,!0));var x=t.useCallback(function(){h(!1),n(w)},[n,w]),E=t.useCallback(function(){h(!1),n(null),k({keysArr:r})},[n,r]);return{dialog:A.exports.jsx(o,l({hidden:!m,onDismiss:E,dialogContentProps:{type:c.normal,title:"Restore data?",closeButtonAriaLabel:"Close",subText:"Do you want to restore the previously entered data before submitting/saving again?"},minWidth:450,modalProps:{isBlocking:!0}},{children:A.exports.jsxs(a,{children:[A.exports.jsx(i,{onClick:x,text:"Yes, restore"}),A.exports.jsx(s,{onClick:E,text:"No"})]})}))}};export{_ as checkHasDraftInStorage,x as checkStorageAndNotify,h as decryptPassword,m as encryptPassword,g as fileToJson,j as getDraftFromStorage,S as jsonToFile,k as removeDraftFromStorage,w as saveDraftToStorage,C as useDraftCheck};
//# sourceMappingURL=index.js.map
